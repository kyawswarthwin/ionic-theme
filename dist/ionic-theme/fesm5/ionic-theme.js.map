{"version":3,"file":"ionic-theme.js.map","sources":["ng://ionic-theme/lib/services/theme.service.ts","ng://ionic-theme/lib/ionic-theme.module.ts"],"sourcesContent":["import { Injectable, InjectionToken, Inject } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { SettingsService } from 'ionic-settings';\nimport Color from 'color';\nimport { StatusBar } from '@ionic-native/status-bar/ngx';\n\nexport interface ThemeConfig {\n  themes: Theme[];\n  defaultTheme: string;\n}\nexport interface Theme {\n  name: string;\n  colors?: IonicColors;\n  properties?: Properties;\n}\nexport interface IonicColors {\n  primary?: string;\n  secondary?: string;\n  tertiary?: string;\n  success?: string;\n  warning?: string;\n  danger?: string;\n  light?: string;\n  medium?: string;\n  dark?: string;\n  foreground?: string;\n  background?: string;\n}\nexport interface Properties {\n  [propertyName: string]: string;\n}\nexport const THEME_CONFIG = new InjectionToken<ThemeConfig>('THEME_CONFIG');\n\n// @dynamic\n@Injectable({\n  providedIn: 'root'\n})\nexport class ThemeService {\n  private theme: BehaviorSubject<Theme>;\n\n  constructor(\n    @Inject(THEME_CONFIG) private config: ThemeConfig,\n    @Inject(DOCUMENT) private document: Document,\n    private settings: SettingsService,\n    private statusBar: StatusBar\n  ) {}\n\n  initialize(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.theme) {\n        this.theme = new BehaviorSubject(\n          this.getTheme(this.settings.get('theme', this.config.defaultTheme))\n        );\n        this.setTheme(this.theme.value);\n      }\n      resolve();\n    });\n  }\n\n  getThemes(): Theme[] {\n    return this.config.themes;\n  }\n\n  getTheme(name: string): Theme {\n    const theme = this.config.themes.find(t => t.name === name);\n    if (!theme) {\n      throw new Error('Theme Not Found');\n    }\n    return theme;\n  }\n\n  isActiveTheme(name: string): boolean {\n    return this.theme.value.name === name;\n  }\n\n  getActiveTheme(): Observable<Theme> {\n    return this.theme.asObservable();\n  }\n\n  setActiveTheme(name: string): void {\n    if (!this.isActiveTheme(name)) {\n      const theme = this.getTheme(name);\n      this.setTheme(theme);\n      this.theme.next(theme);\n    }\n  }\n\n  private setTheme(theme: Theme): void {\n    const properties = this.generateTheme(theme);\n    this.statusBar.backgroundColorByHexString(properties['--ion-color-primary-shade']);\n    this.document.documentElement.style.cssText = Object.entries(properties).reduce(\n      (accumulator, [propertyName, value]) => {\n        return (accumulator += `${propertyName}: ${value};`);\n      },\n      ''\n    );\n    this.settings.set('theme', theme.name);\n  }\n\n  private generateTheme(theme: Theme): Properties {\n    let properties = { ...theme.properties };\n    if (theme.colors) {\n      properties = {\n        ...properties,\n        ...Object.entries(theme.colors)\n          .filter(([name]) => {\n            return [\n              'primary',\n              'secondary',\n              'tertiary',\n              'success',\n              'warning',\n              'danger',\n              'light',\n              'medium',\n              'dark'\n            ].includes(name);\n          })\n          .map(([name, color]) => {\n            color = Color(color);\n            return {\n              [`--ion-color-${name}`]: color.hex(),\n              [`--ion-color-${name}-rgb`]: this.colorToRGB(color),\n              [`--ion-color-${name}-contrast`]: this.contrast(color).hex(),\n              [`--ion-color-${name}-contrast-rgb`]: this.colorToRGB(this.contrast(color)),\n              [`--ion-color-${name}-shade`]: this.shade(color).hex(),\n              [`--ion-color-${name}-tint`]: this.tint(color).hex()\n            };\n          })\n          .reduce((accumulator, currentValue) => {\n            return { ...accumulator, ...currentValue };\n          }, {})\n      };\n      if (theme.colors.background && theme.colors.foreground) {\n        const backgroundColor = Color(theme.colors.background);\n        const foregroundColor = Color(theme.colors.foreground);\n        properties[`--ion-background-color`] = backgroundColor.hex();\n        properties[`--ion-background-color-rgb`] = this.colorToRGB(backgroundColor);\n        properties[`--ion-text-color`] = foregroundColor.hex();\n        properties[`--ion-text-color-rgb`] = this.colorToRGB(foregroundColor);\n        for (let i = 50; i < 1000; i += 50) {\n          properties[`--ion-color-step-${i}`] = foregroundColor\n            .mix(backgroundColor, 1 - i / 1000)\n            .hex();\n        }\n      }\n    }\n    return properties;\n  }\n\n  private colorToRGB(color: Color): string {\n    return color\n      .rgb()\n      .array()\n      .join(', ');\n  }\n\n  private contrast(color: Color): Color {\n    const { r, g, b } = color.rgb().object();\n    return (r + g + b) / 3 > 128 ? Color('#fff') : Color('#000');\n  }\n\n  private shade(color: Color): Color {\n    return color.mix(Color('#000'), 0.12);\n  }\n\n  private tint(color: Color): Color {\n    return color.mix(Color('#fff'), 0.1);\n  }\n}\n","import { NgModule, ModuleWithProviders, APP_INITIALIZER } from '@angular/core';\nimport { SettingsService } from 'ionic-settings';\n\nimport { ThemeConfig, THEME_CONFIG, ThemeService } from './services/theme.service';\n\n// @dynamic\n@NgModule()\nexport class IonicThemeModule {\n  static forRoot(config: ThemeConfig): ModuleWithProviders {\n    return {\n      ngModule: IonicThemeModule,\n      providers: [\n        {\n          provide: THEME_CONFIG,\n          useValue: config\n        },\n        {\n          provide: APP_INITIALIZER,\n          useFactory: (settings: SettingsService, theme: ThemeService) => {\n            return () => {\n              return new Promise(async (resolve, reject) => {\n                await settings.initialize();\n                await theme.initialize();\n                resolve();\n              });\n            };\n          },\n          deps: [SettingsService, ThemeService],\n          multi: true\n        }\n      ]\n    };\n  }\n}\n"],"names":[],"mappings":"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"}
